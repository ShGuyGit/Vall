$DCs = Get-ADDomainController -Filter *
$Results = @()

foreach ($DC in $DCs) {
    $Replication = Get-ADReplicationPartnerMetadata -Target $DC.HostName
    $LastReplication = $Replication | Select-Object LastReplicationSuccess
    $Result = New-Object PSObject -Property @{
        DCName = $DC.HostName
        LastReplicationSuccess = $LastReplication.LastReplicationSuccess
    }
    $Results += $Result
}

$Results | Format-Table -AutoSize | Out-String | Out-File C:\Temp\ReplicationStatus.txt

$EmailFrom = "youremail@yourdomain.com"
$EmailTo = "recipientemail@recipientdomain.com"
$Subject = "AD Replication Status"
$Body = Get-Content C:\Temp\ReplicationStatus.txt | Out-String
$SMTPServer = "smtp.yourdomain.com"


$SMTPMessage = New-Object System.Net.Mail.MailMessage($EmailFrom, $EmailTo, $Subject, $Body)
$SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer, $SmtpPort)
$SMTPClient.EnableSsl = $true
#$SMTPClient.Credentials = New-Object System.Net.NetworkCredential($SMTPUsername, $SMTPPassword)
$SMTPClient.Send($SMTPMessage)
